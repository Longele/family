<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#f4f1ec" id="metaThemeColor" />
  <meta name="format-detection" content="telephone=no" />
  <title>Famille Longele | Arbre familial</title>
  <style>
    /* ‚îÄ‚îÄ Light theme (default) ‚îÄ‚îÄ */
    :root{
      --bg:#f4f1ec;
      --card:#ffffff;
      --card-hover:#f9f8f6;
      --text:#1a1a2e;
      --muted:#6e6e7a;
      --border:#e0ddd6;
      --accent:#2d8a6e;
      --accent-dim:rgba(45,138,110,0.1);
      --shadow-card:0 2px 8px rgba(0,0,0,0.06);
      --shadow-card-hover:0 10px 30px rgba(0,0,0,0.1);
      --toggle-hover-text:#fff;
      --radius:14px;
      --max:1000px;
      --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
    }

    /* ‚îÄ‚îÄ Dark theme ‚îÄ‚îÄ */
    [data-theme="dark"]{
      --bg:#151519;
      --card:#1e1e24;
      --card-hover:#26262e;
      --text:#e8e6e3;
      --muted:#8b8a8d;
      --border:#2e2e36;
      --accent:#6ec1a7;
      --accent-dim:rgba(110,193,167,0.12);
      --shadow-card:0 2px 6px rgba(0,0,0,0.2);
      --shadow-card-hover:0 10px 30px rgba(0,0,0,0.3);
      --toggle-hover-text:#151519;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      background:var(--bg);
      font-family:var(--font);
      color:var(--text);
      transition: background .3s ease, color .3s ease;
      -webkit-tap-highlight-color: transparent;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overscroll-behavior-y: contain;
      overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ */
    .theme-toggle{
      position:fixed; top:18px; right:18px; z-index:100;
      width:44px; height:44px; border-radius:50%;
      border:1px solid var(--border);
      background:var(--card);
      color:var(--text);
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      font-size:18px; line-height:1;
      box-shadow: var(--shadow-card);
      transition: all .2s ease;
    }

    .theme-toggle:hover{
      border-color:var(--accent);
      box-shadow: var(--shadow-card-hover);
      transform:scale(1.08);
    }

    .theme-toggle:active{
      transform:scale(0.95);
    }

    .theme-toggle .icon-sun,
    .theme-toggle .icon-moon{ pointer-events:none; }

    .theme-toggle .icon-moon{ display:none; }
    [data-theme="dark"] .theme-toggle .icon-sun{ display:none; }
    [data-theme="dark"] .theme-toggle .icon-moon{ display:inline; }

    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:60px 20px 80px;
      position:relative;
    }

    .wrap:before{
      content:"";
      position:absolute;
      inset:-40px -20px auto -20px;
      height:220px;
      background: radial-gradient(800px 180px at 30% 20%, var(--accent-dim), transparent 60%);
      pointer-events:none;
      z-index:-1;
    }

    h1{ font-size:clamp(20px, 5vw, 28px); font-weight:600; margin:0 0 8px 0; letter-spacing:-0.5px; color:var(--text); }
    .subtitle{ color:var(--muted); font-size:clamp(12px, 3vw, 14px); margin-bottom:40px; }

    .section{ margin-top:50px; }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(min(260px, 100%),1fr));
      gap:24px;
    }

    .card{
      border:1px solid var(--border); border-radius:var(--radius);
      padding:20px; background:var(--card);
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .3s ease;
      box-shadow: var(--shadow-card);
    }

    .card:hover{
      border-color:var(--accent);
      box-shadow: var(--shadow-card-hover);
      transform: translateY(-2px);
      background:var(--card-hover);
    }

    .name{ font-size:15px; font-weight:600; margin:0; word-break:break-word; overflow-wrap:anywhere; }
    .meta{ font-size:13px; color:var(--muted); margin-top:6px; word-break:break-word; }

    .toggle{
      margin-top:14px;
      font-size:13px;
      font-weight:500;
      padding:8px 14px;
      border-radius:999px;
      border:1px solid var(--border);
      background:var(--accent-dim);
      color:var(--accent);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: all .15s ease;
    }

    .toggle:hover{
      background:var(--accent);
      color:var(--toggle-hover-text);
      border-color:var(--accent);
    }

    .toggle:active{
      transform:scale(0.97);
    }

    .toggle:focus-visible{
      outline:none;
      box-shadow:0 0 0 4px var(--accent-dim);
    }

    .details{
      margin-top:16px; padding-top:14px; border-top:1px solid var(--border);
      font-size:13px; line-height:1.7; max-height:0;
      overflow:hidden; opacity:0; transform: translateY(-2px);
      transition: max-height .22s ease, opacity .18s ease, transform .18s ease;
      color:var(--muted);
    }

    .card.open .details{ opacity:1; transform: translateY(0); }

    .details-row{ display:flex; gap:8px; margin-bottom:8px; flex-wrap:wrap; }
    .details-label{ font-weight:600; min-width:85px; color:var(--muted); flex-shrink:0; }
    .details-value{ flex:1; display:flex; flex-wrap:wrap; gap:6px; min-width:0; }

    .tag{
      background:var(--accent-dim); border:1px solid var(--border);
      padding:4px 8px; border-radius:999px;
      font-size:12px; font-weight:500; white-space:nowrap;
      display:inline-flex; align-items:center;
      color:var(--text);
    }

    .tag.child{ cursor:default; }

    /* DESKTOP: tooltip on hover */
    @media (hover: hover) and (pointer: fine){
      .tag.child{ position:relative; cursor:pointer; }
      .tag.child::after{
        content: attr(data-dob);
        position:absolute; bottom:130%; left:50%;
        transform:translateX(-50%) scale(0.95);
        background:var(--card); color:var(--text); font-size:11px;
        padding:6px 10px; border-radius:8px; border:1px solid var(--border);
        white-space:nowrap; opacity:0;
        pointer-events:none;
        transition:opacity .15s ease, transform .15s ease;
      }
      .tag.child:hover::after{
        opacity:1; transform:translateX(-50%) scale(1);
      }
    }

    /* MOBILE: always show DOB below child name */
    .tag-with-dob{
      display:inline-flex; flex-direction:column; align-items:flex-start;
      gap:2px; white-space:normal; border-radius:12px;
    }

    .dob-sub{
      font-size:10px; font-weight:400; color:var(--muted);
      display:none;
    }

    @media (hover: none), (pointer: coarse){
      .dob-sub{ display:block; }
    }

    mark{ background: var(--accent-dim); padding:1px 4px; border-radius:4px; color:var(--accent); font-weight:600; }

    /* ‚îÄ‚îÄ Stats bar ‚îÄ‚îÄ */
    .stats{
      display:flex; gap:16px; flex-wrap:wrap;
      margin-bottom:24px;
    }

    .stat{
      border:1px solid var(--border); border-radius:var(--radius);
      background:var(--card); padding:14px 18px;
      flex:1; min-width:140px;
    }

    .stat-value{
      font-size:22px; font-weight:700; margin:0;
      letter-spacing:-0.5px; color:var(--accent);
    }

    .stat-label{
      font-size:11px; font-weight:600; text-transform:uppercase;
      letter-spacing:0.8px; color:var(--muted); margin-top:2px;
    }

    /* ‚îÄ‚îÄ Sticky search ‚îÄ‚îÄ */
    .search-bar{
      position:sticky; top:0; z-index:10;
      background:var(--bg); padding:14px 0 10px;
      margin: 0 0 30px;
    }

    .search-bar::before{
      content:''; position:absolute;
      inset: -4px -20px auto -20px; height:calc(100% + 18px);
      background: linear-gradient(var(--bg) 70%, transparent);
      z-index:-1; pointer-events:none;
    }

    .search-inner{
      display:flex; gap:10px; align-items:center;
      max-width:480px;
    }

    .search-inner input{
      flex:1; padding:13px 18px; border-radius:999px;
      border:1px solid var(--border); font-size:14px; outline:none;
      transition:border .2s ease, box-shadow .2s ease;
      background:var(--card); color:var(--text);
    }

    .search-inner input::placeholder{ color:var(--muted); }

    .search-inner input:focus{
      border:1px solid var(--accent);
      box-shadow:0 0 0 4px var(--accent-dim);
    }

    .kbd{
      font-size:11px; font-weight:600; color:var(--muted);
      border:1px solid var(--border); border-radius:6px;
      padding:2px 7px; background:var(--card);
      line-height:1.4; flex-shrink:0;
    }

    /* ‚îÄ‚îÄ Expand/Collapse all ‚îÄ‚îÄ */
    .section-header{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:20px; flex-wrap: wrap; gap: 8px;
    }

    .section-header h2{
      font-size:16px; font-weight:600; margin:0;
      text-transform:uppercase; letter-spacing:1px; color:var(--muted);
    }

    .btn-expand{
      font-size:12px; font-weight:500; padding:6px 14px;
      border-radius:999px; border:1px solid var(--border);
      background:var(--card); color:var(--muted); cursor:pointer;
      transition:all .15s ease;
    }

    .btn-expand:hover{
      background:var(--accent); color:var(--toggle-hover-text); border-color:var(--accent);
    }

    /* ‚îÄ‚îÄ Toggle arrow ‚îÄ‚îÄ */
    .toggle .arrow{
      display:inline-block; font-size:10px;
      transition:transform .2s ease;
    }

    .card.open .toggle .arrow{
      transform:rotate(180deg);
    }

    /* ‚îÄ‚îÄ Birth order badge ‚îÄ‚îÄ */
    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      width:22px; height:22px; border-radius:50%;
      background:var(--accent-dim); border:1px solid var(--accent);
      font-size:11px; font-weight:700; color:var(--accent);
      float:right; margin-top:1px;
    }

    /* ‚îÄ‚îÄ Card entrance animation ‚îÄ‚îÄ */
    @keyframes cardIn {
      from { opacity:0; transform:translateY(12px); }
      to   { opacity:1; transform:translateY(0); }
    }

    .card.animate-in{
      animation: cardIn .35s ease both;
    }

    /* ‚îÄ‚îÄ Empty state ‚îÄ‚îÄ */
    .empty-state{
      text-align:center; padding:40px 20px;
      display:none;
    }

    .empty-state .empty-icon{
      font-size:32px; margin-bottom:10px; display:block;
      opacity:0.5;
    }

    .empty-state p{
      color:var(--muted); font-size:14px; margin:0 0 14px;
    }

    .btn-clear{
      font-size:13px; font-weight:500; padding:8px 18px;
      border-radius:999px; border:1px solid var(--border);
      background:var(--card); color:var(--text); cursor:pointer;
      transition:all .15s ease;
    }

    .btn-clear:hover{
      background:var(--accent); color:var(--toggle-hover-text); border-color:var(--accent);
    }

    .footer{ margin-top:80px; font-size:12px; color:var(--muted); text-align:center; }

    /* ‚îÄ‚îÄ Birthday banner ‚îÄ‚îÄ */
    .bday-banner{
      border:1px solid var(--accent);
      border-radius:var(--radius);
      background:var(--accent-dim);
      padding:16px 20px;
      margin:0 0 22px;
      display:flex;
      align-items:center;
      gap:14px;
      transition: background .3s ease, border-color .3s ease;
    }

    .bday-banner .bday-icon{
      font-size:28px; flex-shrink:0; line-height:1;
    }

    .bday-banner .bday-text{
      flex:1;
    }

    .bday-banner .bday-name{
      font-size:14px; font-weight:600; color:var(--text);
      margin:0 0 2px; word-break:break-word; overflow-wrap:anywhere;
    }

    .bday-banner .bday-date{
      font-size:12px; color:var(--muted); margin:0;
    }

    .bday-banner .bday-days{
      font-size:12px; font-weight:700; color:var(--accent);
      background:var(--card); border:1px solid var(--border);
      padding:6px 12px; border-radius:999px;
      white-space:nowrap; flex-shrink:0;
    }

    .bday-banner.is-today{
      border-color:var(--accent);
      background:var(--accent);
    }

    .bday-banner.is-today .bday-name,
    .bday-banner.is-today .bday-date{
      color:var(--toggle-hover-text);
    }

    .bday-banner.is-today .bday-days{
      background:rgba(255,255,255,0.2);
      border-color:transparent;
      color:var(--toggle-hover-text);
    }

    @media (max-width:600px){
      .bday-banner{ padding:14px 16px; gap:10px; flex-wrap:wrap; }
      .bday-banner .bday-icon{ font-size:24px; }
      .bday-banner .bday-name{ font-size:13px; }
      .bday-banner .bday-date{ font-size:11px; }
      .bday-banner .bday-days{ font-size:11px; padding:5px 10px; }
    }

    .origins{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:var(--card);
      padding:18px 20px;
      margin: 0 0 22px;
    }

    .origins-title{
      font-size:12px;
      font-weight:700;
      letter-spacing:1px;
      color:var(--muted);
      text-transform:uppercase;
      margin:0 0 12px;
    }

    .origins-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(min(180px, 100%), 1fr));
      gap:10px 18px;
    }

    .kv{ display:flex; gap:8px; align-items:baseline; min-width:0; }
    .k{ min-width:0; flex-shrink:0; width:88px; color:var(--muted); font-size:12px; font-weight:600; }
    .v{ color:var(--text); font-size:13px; font-weight:600; word-break:break-word; overflow-wrap:anywhere; min-width:0; }

    /* ‚îÄ‚îÄ Bottom navigation (mobile) ‚îÄ‚îÄ */
    .bottom-nav{
      display:none;
      position:fixed; bottom:0; left:0; right:0; z-index:100;
      background:var(--card);
      border-top:1px solid var(--border);
      padding:6px 0 env(safe-area-inset-bottom, 8px);
      transition: background .3s ease, border-color .3s ease;
    }

    .bottom-nav-inner{
      display:flex; justify-content:space-around; align-items:center;
      max-width:400px; margin:0 auto;
    }

    .nav-item{
      display:flex; flex-direction:column; align-items:center;
      gap:3px; padding:6px 12px;
      border:none; background:none;
      color:var(--muted); cursor:pointer;
      font-family:var(--font);
      transition:color .15s ease;
      -webkit-tap-highlight-color:transparent;
      border-radius:10px;
    }

    .nav-item.active{
      color:var(--accent);
    }

    .nav-item:active{
      background:var(--accent-dim);
    }

    .nav-item .nav-icon{
      font-size:20px; line-height:1;
    }

    .nav-item .nav-label{
      font-size:10px; font-weight:600;
      letter-spacing:0.3px;
    }

    /* ‚îÄ‚îÄ Mobile app overrides ‚îÄ‚îÄ */
    @media (max-width:600px){
      .bottom-nav{ display:block; }

      .wrap{
        padding: 20px 16px 100px;
      }

      /* App-like header */
      .app-header{
        position:sticky; top:0; z-index:50;
        background:var(--bg);
        padding:14px 0 10px;
        margin: 0 -16px 16px;
        padding-left:16px; padding-right:16px;
        transition: background .3s ease;
      }

      .app-header h1{ font-size: 22px; margin-bottom:2px; }
      .app-header .subtitle{ font-size: 12px; margin-bottom: 0; }

      /* Full-width cards on mobile */
      .card{
        border-radius:12px;
        padding:16px;
        border-left:none;
        border-right:none;
        margin-left:-2px; margin-right:-2px;
      }

      .card:active{
        transform:scale(0.985);
        transition:transform .1s ease;
      }

      /* Bigger touch targets */
      .toggle{
        width:100%;
        justify-content:center;
        min-height:44px;
        font-size: 13px;
        border-radius:10px;
      }

      .btn-expand{
        min-height:36px;
        padding:8px 16px;
      }

      /* Stats as horizontal scroll */
      .stats{
        flex-wrap:nowrap;
        overflow-x:auto;
        -webkit-overflow-scrolling:touch;
        scroll-snap-type:x mandatory;
        gap:10px;
        padding-bottom:4px;
        scrollbar-width:none;
      }

      .stats::-webkit-scrollbar{ display:none; }

      .stat{
        scroll-snap-align:start;
        min-width:110px;
        flex:0 0 auto;
      }

      .stat-value{ font-size:18px; }
      .stat-label{ font-size:10px; }

      /* Search bar full width */
      .search-inner{
        max-width:100%;
      }

      .search-inner input{
        border-radius:12px;
      }

      /* Hide keyboard shortcut hint on mobile */
      .kbd{ display:none; }

      /* Theme toggle repositioned for mobile */
      .theme-toggle{
        top:auto; bottom:auto;
        position:static;
        width:36px; height:36px;
        font-size:15px;
        box-shadow:none;
        border:1px solid var(--border);
      }

      .footer{ display:none; }

      /* Section scroll targets offset for sticky header */
      .section[id]{
        scroll-margin-top:120px;
      }

      /* Origins as compact chip row */
      .origins{
        border-radius:12px;
        padding:14px 16px;
      }

      .bday-banner{
        border-radius:12px;
        flex-direction:row;
      }

      .bday-banner .bday-name{ font-size:13px; }
      .bday-banner .bday-date{ font-size:11px; }
      .bday-banner .bday-icon{ font-size:22px; }
      .bday-banner .bday-days{ font-size:11px; padding:5px 10px; }

      /* Origins single column on mobile */
      .origins-grid{ grid-template-columns:1fr; gap:8px; }

      .kv{ gap:6px; }
      .k{ width:80px; font-size:11px; }
      .v{ font-size:12px; }
    }

    /* Small phones & Z Fold cover screen */
    @media (max-width:380px){
      .wrap{ padding: 16px 12px 100px; }
      .app-header h1{ font-size: 18px; }
      .app-header .subtitle{ font-size:11px; }
      .card{ padding: 12px; border-radius:10px; }
      .name{ font-size: 13px; }
      .meta{ font-size: 11px; }
      .toggle{ font-size:12px; padding:7px 12px; min-height:40px; }
      .origins{ padding: 12px 14px; border-radius:10px; }
      .stat{ min-width:95px; padding:10px 12px; }
      .stat-value{ font-size:16px; }
      .stat-label{ font-size:9px; }
      .details{ font-size:11px; }
      .details-label{ font-size:10px; min-width:unset; }
      .tag{ font-size:10px; padding:3px 7px; }
      .badge{ width:20px; height:20px; font-size:10px; }
      .bday-banner{ padding:12px; gap:8px; }
      .bday-banner .bday-name{ font-size:12px; }
      .bday-banner .bday-date{ font-size:10px; }
      .bday-banner .bday-days{ font-size:10px; padding:4px 8px; }
      .bday-banner .bday-icon{ font-size:20px; }
      .section-header h2{ font-size:12px; letter-spacing:0.5px; }
      .btn-expand{ font-size:11px; padding:6px 12px; }
      .nav-item .nav-icon{ font-size:18px; }
      .nav-item .nav-label{ font-size:9px; }
      .search-inner input{ padding:10px 14px; font-size:15px; }
      .k{ width:72px; font-size:10px; }
      .v{ font-size:11px; }
      .origins-title{ font-size:10px; }
    }

    /* Ultra-narrow (Z Fold cover, small screens <320px) */
    @media (max-width:320px){
      .wrap{ padding:12px 10px 96px; }
      .app-header h1{ font-size:17px; }
      .card{ padding:10px; }
      .name{ font-size:12px; }
      .stat{ min-width:85px; padding:8px 10px; }
      .stat-value{ font-size:15px; }
      .nav-item{ padding:5px 8px; }
      .nav-item .nav-label{ font-size:8px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="app-header">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div>
          <h1>Arbre familial</h1>
          <div class="subtitle">Famille Longele</div>
        </div>
        <button class="theme-toggle" id="themeToggle" aria-label="Changer de th√®me">
          <span class="icon-sun">‚òÄÔ∏è</span>
          <span class="icon-moon">üåô</span>
        </button>
      </div>
    </div>

    <div class="origins" aria-label="Origines">
      <div class="origins-title">Origines</div>
      <div class="origins-grid">
        <div class="kv"><div class="k">Village</div><div class="v">BARINGA</div></div>
        <div class="kv"><div class="k">Secteur</div><div class="v">BEFUMBO</div></div>
        <div class="kv"><div class="k">Chefferie</div><div class="v">BOLIFA</div></div>
        <div class="kv"><div class="k">Territoire</div><div class="v">BEFALE</div></div>
        <div class="kv"><div class="k">Province</div><div class="v">TSHUAPA</div></div>
        <div class="kv"><div class="k">Ethnie</div><div class="v">M√ñNG√ñ</div></div>
      </div>
    </div>

    <div id="bdayBanner" class="bday-banner" style="display:none"></div>

    <div class="stats" id="stats"></div>

    <div class="search-bar">
      <div class="search-inner">
        <input id="q" type="search" placeholder="Rechercher un pr√©nom..." />
        <span class="kbd">/</span>
      </div>
    </div>

    <div class="section" id="sec-parents">
      <div class="section-header">
        <h2>Parents</h2>
      </div>
      <div class="grid" id="parents"></div>
    </div>

    <div class="section" id="sec-children">
      <div class="section-header">
        <h2>Enfants</h2>
        <button class="btn-expand" id="toggleAll" onclick="toggleAllDetails()">Tout ouvrir</button>
      </div>
      <div class="grid" id="children"></div>
      <div class="subtitle" id="count"></div>
      <div class="empty-state" id="empty">
        <span class="empty-icon">üîç</span>
        <p>Aucun membre trouv√© pour cette recherche.</p>
        <button class="btn-clear" onclick="clearSearch()">Effacer la recherche</button>
      </div>
    </div>

    <div class="footer">Appuie sur <strong>/</strong> pour rechercher.</div>
  </div>

  <!-- Bottom navigation (mobile) -->
  <nav class="bottom-nav">
    <div class="bottom-nav-inner">
      <button class="nav-item active" onclick="scrollToSection('top')">
        <span class="nav-icon">üè†</span>
        <span class="nav-label">Accueil</span>
      </button>
      <button class="nav-item" onclick="scrollToSection('parents')">
        <span class="nav-icon">üë®‚Äçüë©‚Äçüëß</span>
        <span class="nav-label">Parents</span>
      </button>
      <button class="nav-item" onclick="scrollToSection('children')">
        <span class="nav-icon">üë∂</span>
        <span class="nav-label">Enfants</span>
      </button>
      <button class="nav-item" onclick="document.getElementById('q').focus()">
        <span class="nav-icon">üîç</span>
        <span class="nav-label">Recherche</span>
      </button>
    </div>
  </nav>

  <script>
    // ‚îÄ‚îÄ Theme toggle ‚îÄ‚îÄ
    const $theme = document.getElementById('themeToggle')
    function setTheme(mode){
      document.documentElement.setAttribute('data-theme', mode)
      localStorage.setItem('theme', mode)
      const mc = document.getElementById('metaThemeColor')
      if(mc) mc.setAttribute('content', mode === 'dark' ? '#151519' : '#f4f1ec')
    }
    // Default: light. Restore saved preference.
    const saved = localStorage.getItem('theme') || 'light'
    if(saved === 'dark') setTheme('dark')

    $theme.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme') || 'light'
      setTheme(current === 'dark' ? 'light' : 'dark')
    })

    // ‚îÄ‚îÄ Bottom nav: scroll & active state ‚îÄ‚îÄ
    function scrollToSection(id){
      if(id === 'top'){
        window.scrollTo({ top:0, behavior:'smooth' })
      } else {
        const el = document.getElementById('sec-' + id)
        if(el) el.scrollIntoView({ behavior:'smooth', block:'start' })
      }
      // Update active nav
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'))
      event.currentTarget.classList.add('active')
    }

    // Track scroll to update active nav item
    if(window.matchMedia('(max-width:600px)').matches){
      const sections = [
        { id:'top', el: document.querySelector('.app-header') },
        { id:'parents', el: document.getElementById('sec-parents') },
        { id:'children', el: document.getElementById('sec-children') }
      ]
      const navItems = document.querySelectorAll('.nav-item')
      const navMap = { top:0, parents:1, children:2 }

      window.addEventListener('scroll', () => {
        let current = 'top'
        sections.forEach(s => {
          if(s.el && s.el.getBoundingClientRect().top <= 150) current = s.id
        })
        navItems.forEach(n => n.classList.remove('active'))
        if(navMap[current] !== undefined && navItems[navMap[current]]){
          navItems[navMap[current]].classList.add('active')
        }
      }, { passive:true })
    }

    const isTouch = window.matchMedia('(hover: none), (pointer: coarse)').matches

    const data = {
      parents:[{
        name:"Antoine Longele et Albertine Ifoma",
        dob:"Antoine: 29 d√©cembre 1952 | Albertine: 05 novembre 1957",
        details:`Parents d'Antoine: P√®re: Isoloke Ekanga Puis, M√®re: Efetsi Etoto Clara<br>
                 Fr√®res et s≈ìurs d'Antoine: Eyoku Camille, Lofinda Pius, Mboyo Marie-Pauline, Bangwala Jean Pierre, Lombeku Camille, Etoto Pautace, Isoloke Pius, Eyoku Marie-Fran√ßois<br>
                 Parents d'Albertine: P√®re: Ifoma Ekumbo, M√®re: Bioke Bokamua<br>
                 Fr√®res et s≈ìurs d'Albertine: Theo, Christine, Apolo, Marie, Ida, Bienvenu, Louis, Mimie, Noel, Mima`
      }],
      children:[
        {name:"Alec Boketshu Longele",dob:"29 juillet 1979",details:"Conjointe: Patience Mpasi<br>Enfants: Gael|, Ryan|, Shekinah|, Alec Jr|31 janvier 2026, Alec√ßia|31 janvier 2026"},
        {name:"Dina Mboyo Longele",dob:"16 d√©cembre 1981",details:"Conjoint: Didi Mayala<br>Enfants: Oracle|, Nesrine|, Bliss|, Kelya|"},
        {name:"Ruphin Ekanga Longele",dob:"11 avril 1983",details:""},
        {name:"Yvon Ekala Longele",dob:"03 mars 1985",details:"Conjointe: Caroline Kolesa<br>Enfants: Yaves|10 mai 2014, Ariel|08 d√©cembre 2015"},
        {name:"Jimmy Eyoku Longele",dob:"15 septembre 1986",details:"Conjointe: Carole Mpata<br>Enfant: Jayden|03 juillet 2015"},
        {name:"Jeff Etoto Longele",dob:"28 juin 1989",details:"Conjointe: Stephie Djangi<br>Enfants: Jasmine-Lola|16 janvier 2022, Nael|01 d√©cembre 2023"},
        {name:"Lysie Efetsi Longele",dob:"09 d√©cembre 1990",details:"Conjoint: Didier Samba<br>Enfants: Heaven|14 janvier 2022, Elikya|22 juillet 2023"},
        {name:"Danielle Ifoma Longele",dob:"17 septembre 1993",details:"Conjoint: Yvan Ilunga<br>Enfants: Kimya|12 juin 2019, Angelika|08 septembre 2022, Lumiya|28 d√©cembre 2025"}
      ]
    }

    const $parents = document.getElementById('parents')
    const $children = document.getElementById('children')
    const $q = document.getElementById('q')
    const $count = document.getElementById('count')
    const $empty = document.getElementById('empty')
    const $stats = document.getElementById('stats')
    const $toggleAll = document.getElementById('toggleAll')
    let allExpanded = false

    function escapeHtml(str){
      return String(str||'').replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]))
    }

    // Count total grandchildren
    function countGrandchildren(){
      let count = 0
      data.children.forEach(c => {
        if(!c.details) return
        const rows = c.details.split('<br>')
        rows.forEach(r => {
          if(r.split(':')[0].toLowerCase().includes('enfant')){
            const val = r.split(':').slice(1).join(':').trim()
            const kids = val.split(',').map(v=>v.trim()).filter(v=>v && v !== '|')
            count += kids.length
          }
        })
      })
      return count
    }

    function renderStats(){
      const gc = countGrandchildren()
      $stats.innerHTML = `
        <div class="stat"><div class="stat-value">${data.children.length}</div><div class="stat-label">Enfants</div></div>
        <div class="stat"><div class="stat-value">${gc}</div><div class="stat-label">Petits-enfants</div></div>
        <div class="stat"><div class="stat-value">${data.children.length + gc + 2}</div><div class="stat-label">Membres total</div></div>
      `
    }

    // ‚îÄ‚îÄ Next birthday logic ‚îÄ‚îÄ
    const frMonths = {
      'janvier':0,'f\u00e9vrier':1,'mars':2,'avril':3,'mai':4,'juin':5,
      'juillet':6,'ao\u00fbt':7,'septembre':8,'octobre':9,'novembre':10,'d\u00e9cembre':11
    }

    function parseFrDate(str){
      if(!str) return null
      const parts = str.trim().split(/\s+/)
      if(parts.length < 3) return null
      const day = parseInt(parts[0], 10)
      const month = frMonths[parts[1].toLowerCase()]
      const year = parseInt(parts[2], 10)
      if(isNaN(day) || month === undefined || isNaN(year)) return null
      return { day, month, year }
    }

    function getAllBirthdays(){
      const list = []

      // Parents
      list.push({ name: 'Antoine Longele', date: parseFrDate('29 d\u00e9cembre 1952') })
      list.push({ name: 'Albertine Ifoma', date: parseFrDate('05 novembre 1957') })

      // Children
      data.children.forEach(c => {
        const firstName = c.name.split(' ')[0]
        list.push({ name: firstName + ' Longele', date: parseFrDate(c.dob) })

        // Grandchildren
        if(!c.details) return
        c.details.split('<br>').forEach(row => {
          const parts = row.split(':')
          if(parts.length < 2) return
          if(!parts[0].toLowerCase().includes('enfant')) return
          const val = parts.slice(1).join(':').trim()
          val.split(',').forEach(item => {
            const [rawName, rawDate] = item.split('|').map(x => (x||'').trim())
            if(rawName && rawDate){
              list.push({ name: rawName, date: parseFrDate(rawDate) })
            }
          })
        })
      })

      return list.filter(b => b.date)
    }

    function getNextBirthday(){
      const today = new Date()
      const todayMonth = today.getMonth()
      const todayDay = today.getDate()
      const birthdays = getAllBirthdays()
      let closest = null
      let minDays = Infinity

      birthdays.forEach(b => {
        const bd = b.date
        // Next occurrence of this birthday
        let nextBday = new Date(today.getFullYear(), bd.month, bd.day)
        if(nextBday < today && !(nextBday.getMonth() === todayMonth && nextBday.getDate() === todayDay)){
          nextBday = new Date(today.getFullYear() + 1, bd.month, bd.day)
        }
        const diff = Math.ceil((nextBday - today) / (1000 * 60 * 60 * 24))
        const daysAway = (nextBday.getMonth() === todayMonth && nextBday.getDate() === todayDay) ? 0 : diff

        if(daysAway < minDays){
          minDays = daysAway
          const age = today.getFullYear() - bd.year + (daysAway === 0 ? 0 : (nextBday.getFullYear() > today.getFullYear() ? 0 : 0))
          const nextYear = nextBday.getFullYear()
          const turnsAge = nextYear - bd.year
          closest = { name: b.name, day: bd.day, month: bd.month, daysAway, turnsAge }
        }
      })
      return closest
    }

    function renderBirthdayBanner(){
      const $banner = document.getElementById('bdayBanner')
      const next = getNextBirthday()
      if(!next){ $banner.style.display = 'none'; return }

      const monthNames = ['janvier','f\u00e9vrier','mars','avril','mai','juin','juillet','ao\u00fbt','septembre','octobre','novembre','d\u00e9cembre']
      const dateStr = next.day + ' ' + monthNames[next.month]
      const isToday = next.daysAway === 0

      let daysLabel
      if(isToday){
        daysLabel = "Aujourd'hui \ud83c\udf89"
      } else if(next.daysAway === 1){
        daysLabel = 'Demain'
      } else {
        daysLabel = 'Dans ' + next.daysAway + ' jours'
      }

      $banner.className = 'bday-banner' + (isToday ? ' is-today' : '')
      $banner.style.display = 'flex'
      $banner.innerHTML = `
        <span class="bday-icon">${isToday ? '\ud83c\udf82' : '\ud83c\udf81'}</span>
        <div class="bday-text">
          <p class="bday-name">${isToday ? 'Joyeux anniversaire' : 'Prochain anniversaire'} \u2014 ${escapeHtml(next.name)}</p>
          <p class="bday-date">${dateStr} \u2022 ${next.turnsAge} ans</p>
        </div>
        <span class="bday-days">${daysLabel}</span>
      `
    }

    function setDetailsHeight(card, open){
      const d = card.querySelector('.details')
      if(!d) return
      d.style.maxHeight = open ? d.scrollHeight + 'px' : '0px'
    }

    function highlightText(text, query){
      if(!query) return escapeHtml(text)
      const escaped = escapeHtml(text)
      const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi')
      return escaped.replace(regex, '<mark>$1</mark>')
    }

    function createCard(item, index, isChild){
      const card = document.createElement('div')
      card.className = 'card animate-in'
      card.style.animationDelay = (index * 0.06) + 's'
      card.dataset.search = (item.name + item.dob + (item.details||'')).toLowerCase()
      card.dataset.name = item.name
      card.dataset.dob = item.dob

      let formatted = ''
      if(item.details){
        const rows = item.details.split('<br>').map(r=>r.trim()).filter(Boolean)
        formatted = rows.map(row => {
          const parts = row.split(':')
          if(parts.length > 1){
            const label = escapeHtml(parts[0])
            const raw = parts.slice(1).join(':').trim()
            const items = raw.split(',').map(v=>v.trim()).filter(Boolean)
            let html = ''
            if(parts[0].toLowerCase().includes('enfant')){
              html = items.map(i => {
                const [n,d] = i.split('|').map(x=>(x||'').trim())
                const dobText = d ? d : ''
              const dobHtml = dobText ? `<span class="dob-sub">${escapeHtml(dobText)}</span>` : ''
              const extraClass = dobText ? ' tag-with-dob' : ''
              return `<span class="tag child${extraClass}" data-dob="N√©(e): ${escapeHtml(d)}">${escapeHtml(n)}${dobHtml}</span>`
              }).join('')
            } else {
              html = items.map(i=>`<span class="tag">${escapeHtml(i)}</span>`).join('')
            }
            return `<div class="details-row"><div class="details-label">${label}</div><div class="details-value">${html}</div></div>`
          }
          return ''
        }).join('')
      }

      const badge = isChild ? `<span class="badge">${index + 1}</span>` : ''

      card.innerHTML = `
        ${badge}
        <p class="name">${escapeHtml(item.name)}</p>
        <p class="meta">N√©(e): ${escapeHtml(item.dob)}</p>
        ${item.details ? `<button class="toggle">Voir d√©tails <span class="arrow">‚ñº</span></button><div class="details">${formatted}</div>` : ''}
      `

      const btn = card.querySelector('.toggle')
      if(btn){
        btn.addEventListener('click', () => {
          const open = card.classList.toggle('open')
          setDetailsHeight(card, open)
          const label = btn.querySelector('span') ? btn.childNodes[0] : btn
          if(btn.childNodes[0].nodeType === 3){
            btn.childNodes[0].textContent = open ? 'Masquer ' : 'Voir d√©tails '
          }
        })
      }

      return card
    }

    function updateCount(){
      const total = data.children.length
      const visible = Array.from(document.querySelectorAll('#children .card'))
        .filter(c => c.style.display !== 'none').length
      $count.textContent = visible + ' sur ' + total + ' membres'
      $empty.style.display = visible === 0 ? 'block' : 'none'
    }

    function filterAll(q){
      const query = (q || '').toLowerCase().trim()

      document.querySelectorAll('.card').forEach(card => {
        const ok = !query || (card.dataset.search || '').includes(query)
        card.style.display = ok ? '' : 'none'

        // Highlight matching text
        const nameEl = card.querySelector('.name')
        const metaEl = card.querySelector('.meta')
        if(nameEl) nameEl.innerHTML = highlightText(card.dataset.name, query)
        if(metaEl) metaEl.innerHTML = highlightText('N√©(e): ' + card.dataset.dob, query)
      })

      // Scroll to first visible result when searching
      if(query){
        const first = document.querySelector('.card[style=""], .card:not([style])')
        if(first && first.style.display !== 'none'){
          first.scrollIntoView({ behavior:'smooth', block:'nearest' })
        }
      }

      updateCount()
    }

    function clearSearch(){
      $q.value = ''
      filterAll('')
      $q.focus()
    }

    function toggleAllDetails(){
      allExpanded = !allExpanded
      document.querySelectorAll('#children .card').forEach(card => {
        const hasDetails = card.querySelector('.details')
        if(!hasDetails) return
        if(allExpanded){
          card.classList.add('open')
        } else {
          card.classList.remove('open')
        }
        setDetailsHeight(card, allExpanded)
        const btn = card.querySelector('.toggle')
        if(btn && btn.childNodes[0].nodeType === 3){
          btn.childNodes[0].textContent = allExpanded ? 'Masquer ' : 'Voir d√©tails '
        }
      })
      $toggleAll.textContent = allExpanded ? 'Tout fermer' : 'Tout ouvrir'
    }

    function render(){
      $parents.innerHTML = ''
      $children.innerHTML = ''
      data.parents.forEach((p, i) => $parents.appendChild(createCard(p, i, false)))
      data.children.forEach((c, i) => $children.appendChild(createCard(c, i, true)))
      renderStats()
      renderBirthdayBanner()
      filterAll($q.value)
    }

    // Keyboard shortcut: / to focus search
    document.addEventListener('keydown', e => {
      if(e.key === '/' && document.activeElement !== $q){
        e.preventDefault()
        $q.focus()
      }
      if(e.key === 'Escape' && document.activeElement === $q){
        $q.blur()
      }
    })

    $q.addEventListener('input', e => filterAll(e.target.value))

    render()
  </script>
</body>
</html>
